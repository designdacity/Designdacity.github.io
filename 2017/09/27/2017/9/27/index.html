<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>Nodejs 学习小结 | Designdacity&#39;s BLOG | Life is Struggle , To Be Coder Shit.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="node">
    <meta name="description" content="nodejs学习小结    最近这段时间一直都有在玩nodejs，边学习边总结了一些零零散散的笔记，今天要总结在一起，方便自己查阅和总结。 1. mongodb启动 确保你的电脑上安装了mongodb，进入mongodb的bin目录，执行mongod --dbpath 数据库地址。例如mongod --dbpath F:\dataBase;  2. 修改node的渲染模板修改app.js里面的内容">
<meta name="keywords" content="node">
<meta property="og:type" content="article">
<meta property="og:title" content="Nodejs 学习小结">
<meta property="og:url" content="http://yoursite.com/2017/09/27/2017/9/27/index.html">
<meta property="og:site_name" content="Designdacity&#39;s BLOG">
<meta property="og:description" content="nodejs学习小结    最近这段时间一直都有在玩nodejs，边学习边总结了一些零零散散的笔记，今天要总结在一起，方便自己查阅和总结。 1. mongodb启动 确保你的电脑上安装了mongodb，进入mongodb的bin目录，执行mongod --dbpath 数据库地址。例如mongod --dbpath F:\dataBase;  2. 修改node的渲染模板修改app.js里面的内容">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-09-27T15:24:55.896Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nodejs 学习小结">
<meta name="twitter:description" content="nodejs学习小结    最近这段时间一直都有在玩nodejs，边学习边总结了一些零零散散的笔记，今天要总结在一起，方便自己查阅和总结。 1. mongodb启动 确保你的电脑上安装了mongodb，进入mongodb的bin目录，执行mongod --dbpath 数据库地址。例如mongod --dbpath F:\dataBase;  2. 修改node的渲染模板修改app.js里面的内容">
    
        <link rel="alternate" type="application/atom+xml" title="Designdacity&#39;s BLOG" href="/atom.xml">
    
    <link rel="shortcut icon" href="/./img/avatar.jpg">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/./img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/./img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lei Y1</h5>
          <a href="mailto:full-stack.ly@foxmail.com" title="full-stack.ly@foxmail.com" class="mail">full-stack.ly@foxmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/designdacity" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://segmentfault.com/u/l_57fe204f9c4d2" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                Segmentfault
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://juejin.im/user/57f05a528ac24700587bf8bb" target="_blank" >
                <i class="icon icon-lg icon-pencil"></i>
                掘金
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Nodejs 学习小结</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Nodejs 学习小结</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-09-27T15:24:55.215Z" itemprop="datePublished" class="page-time">
  2017-09-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/node/">node</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#nodejs学习小结"><span class="post-toc-number">1.</span> <span class="post-toc-text">nodejs学习小结</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-mongodb启动"><span class="post-toc-number">1.0.1.</span> <span class="post-toc-text">1. mongodb启动</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-修改node的渲染模板"><span class="post-toc-number">1.0.2.</span> <span class="post-toc-text">2. 修改node的渲染模板</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-获取前端传来的参数"><span class="post-toc-number">1.0.3.</span> <span class="post-toc-text">3. 获取前端传来的参数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-分页的做法"><span class="post-toc-number">1.0.4.</span> <span class="post-toc-text">4. 分页的做法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-新建一个工程"><span class="post-toc-number">1.0.5.</span> <span class="post-toc-text">5. 新建一个工程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6-小tips：快速删除node-modules"><span class="post-toc-number">1.0.6.</span> <span class="post-toc-text">6. 小tips：快速删除node_modules</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-ejs模板的引用"><span class="post-toc-number">1.0.7.</span> <span class="post-toc-text">7. ejs模板的引用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#8-页面布局"><span class="post-toc-number">1.0.8.</span> <span class="post-toc-text">8. 页面布局</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-如何字符串加密"><span class="post-toc-number">1.0.9.</span> <span class="post-toc-text">9. 如何字符串加密?</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-session的使用"><span class="post-toc-number">1.0.10.</span> <span class="post-toc-text">10. session的使用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-Express-模板传值对象app-locals、res-locals"><span class="post-toc-number">1.0.11.</span> <span class="post-toc-text">11. Express 模板传值对象app.locals、res.locals</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#12-node文件读取模块fs"><span class="post-toc-number">1.0.12.</span> <span class="post-toc-text">12. node文件读取模块fs</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-mongodb的使用"><span class="post-toc-number">1.0.13.</span> <span class="post-toc-text">13. mongodb的使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-、如何开启mongodb"><span class="post-toc-number">1.0.13.1.</span> <span class="post-toc-text">(1)、如何开启mongodb</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#如何查看有多少数据库"><span class="post-toc-number">1.0.13.2.</span> <span class="post-toc-text">如何查看有多少数据库</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-mongoose的使用"><span class="post-toc-number">1.0.13.3.</span> <span class="post-toc-text">(2)mongoose的使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#1-、具体的使用"><span class="post-toc-number">1.0.13.3.1.</span> <span class="post-toc-text">(1)、具体的使用</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#2-、Schema-表结构"><span class="post-toc-number">1.0.13.3.2.</span> <span class="post-toc-text">(2)、Schema - 表结构</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#3-、model-文档操作"><span class="post-toc-number">1.0.13.3.3.</span> <span class="post-toc-text">(3)、model - 文档操作</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#4-、Entity-文档操作"><span class="post-toc-number">1.0.13.3.4.</span> <span class="post-toc-text">(4)、Entity -文档操作</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#5-、修改器和更新器"><span class="post-toc-number">1.0.13.3.5.</span> <span class="post-toc-text">(5)、修改器和更新器</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#6-、数组修改器"><span class="post-toc-number">1.0.13.3.6.</span> <span class="post-toc-text">(6)、数组修改器:</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#7-、条件查询"><span class="post-toc-number">1.0.13.3.7.</span> <span class="post-toc-text">(7)、条件查询:</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#8-、或查询-OR"><span class="post-toc-number">1.0.13.3.8.</span> <span class="post-toc-text">(8)、或查询 OR:</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#9-、类型查询"><span class="post-toc-number">1.0.13.3.9.</span> <span class="post-toc-text">(9)、类型查询:</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#11-、查询数组"><span class="post-toc-number">1.0.13.3.10.</span> <span class="post-toc-text">(11)、查询数组:</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#12-、where"><span class="post-toc-number">1.0.13.3.11.</span> <span class="post-toc-text">(12)、where</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#13-、ObjectId"><span class="post-toc-number">1.0.13.3.12.</span> <span class="post-toc-text">(13)、ObjectId</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#14-、mongoose中的schema-index"><span class="post-toc-number">1.0.13.3.13.</span> <span class="post-toc-text">(14)、mongoose中的schema.index</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-2017/9/27"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Nodejs 学习小结</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-09-27 23:24:55" datetime="2017-09-27T15:24:55.215Z"  itemprop="datePublished">2017-09-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/node/">node</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="nodejs学习小结"><a href="#nodejs学习小结" class="headerlink" title="nodejs学习小结"></a>nodejs学习小结</h2><p>    最近这段时间一直都有在玩nodejs，边学习边总结了一些零零散散的笔记，今天要总结在一起，方便自己查阅和总结。</p>
<h4 id="1-mongodb启动"><a href="#1-mongodb启动" class="headerlink" title="1. mongodb启动"></a>1. mongodb启动</h4><blockquote>
<p>确保你的电脑上安装了<code>mongodb</code>，进入<code>mongodb</code>的<code>bin</code>目录，执行<code>mongod --dbpath</code> 数据库地址。<br>例如<code>mongod --dbpath F:\dataBase</code>;</p>
</blockquote>
<h4 id="2-修改node的渲染模板"><a href="#2-修改node的渲染模板" class="headerlink" title="2. 修改node的渲染模板"></a>2. 修改node的渲染模板</h4><p>修改app.js里面的内容，可以修改为你的模板为ejs、html等<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ejs = <span class="built_in">require</span>(<span class="string">'ejs'</span>);</div><div class="line">...</div><div class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</div><div class="line">app.engine(<span class="string">'.html'</span>, ejs.__express);</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'html'</span>);</div></pre></td></tr></table></figure></p>
<h4 id="3-获取前端传来的参数"><a href="#3-获取前端传来的参数" class="headerlink" title="3. 获取前端传来的参数"></a>3. 获取前端传来的参数</h4><ul>
<li><code>req.query</code> 主要获取GET请求传来的参数。<br>获取到的是一个object，如果要获取具体值，可以<code>req.query.id</code>等</li>
<li><code>req.params</code>获取的值是url后面的一部分，处理 get 和 post 请求<br>比如<code>GET /topic?id=58ff17984edb452fd0fa2cee&amp;node_cat=node8 200 25.245 ms - 331</code>,需要自己拆解</li>
<li><code>req.body</code>主要获取POST请求参数<br>解析body不是nodejs默认提供的，你需要载入<code>body-parser</code>中间件才可以使用<code>req.body</code><br>查找优先级由高到低为 <code>req.params→req.body→req.query</code></li>
</ul>
<h4 id="4-分页的做法"><a href="#4-分页的做法" class="headerlink" title="4. 分页的做法"></a>4. 分页的做法</h4><ul>
<li><p>可以先获取你要获取的数据的总数，这里需要mongod单独去查一次，比如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">exports.getCountByQuery(query, callback)&#123;</div><div class="line">  Topic.count(query,callback);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>分find结合一起使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> limit =<span class="built_in">Number</span>(req.query.limit) || <span class="number">10</span>;</div><div class="line"><span class="keyword">var</span> page = <span class="built_in">Number</span>(req.query.page) || <span class="number">1</span>;</div><div class="line"><span class="keyword">var</span> options = &#123;<span class="attr">skip</span>:(page - <span class="number">1</span>)* limit,<span class="attr">limit</span>:limit &#125;; </div><div class="line">exports.findByQuery(data,options,callback)&#123;</div><div class="line">  Topic.find(data,<span class="literal">null</span>,options,(err,doc) =&gt; &#123;</div><div class="line">    <span class="keyword">if</span>(err)&#123;</div><div class="line">      <span class="keyword">return</span> callback(err);</div><div class="line">    &#125;</div><div class="line">    callback(<span class="literal">null</span>,doc);</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="5-新建一个工程"><a href="#5-新建一个工程" class="headerlink" title="5. 新建一个工程"></a>5. 新建一个工程</h4><p>首先需要在全局安装 express <code>npm install express-generator -g</code></p>
<ul>
<li>在命令行中输入：<code>express -e 项目名</code> 初始化了一个使用 ejs 模板引擎的工程<code>cd 项目名 &amp;&amp; npm install</code></li>
<li>运行 ：<code>npm start</code> 再在浏览器输入对应的窗口即可</li>
<li><p>自动更新：<br>安装个supervisor<code>npm -g install supervisor</code>supervisor必须全局安装<br>启动时执行 <code>supervisor app.js</code>。express已经替换了启动方式，所以启动时执行 <code>supervisor ./bin/www</code></p>
<h4 id="6-小tips：快速删除node-modules"><a href="#6-小tips：快速删除node-modules" class="headerlink" title="6. 小tips：快速删除node_modules"></a>6. 小tips：快速删除node_modules</h4></li>
<li><p>安装个全局的rimraf <code>npm install rimraf -g</code>,</p>
</li>
<li><p>在需要删除<code>node_modules</code>的目录下，执行<code>rimraf node_modules</code></p>
<h4 id="7-ejs模板的引用"><a href="#7-ejs模板的引用" class="headerlink" title="7. ejs模板的引用"></a>7. ejs模板的引用</h4></li>
<li><p>在view目录下新建一个other.ejs,如果要往里面传数据，可以在router里面写<code>res.render(&#39;other&#39;, { title: &#39;hello world&#39; })</code>;<br><code>&lt;% code %&gt;</code>：JavaScript 代码。<br><code>&lt;%= code %&gt;</code>：显示替换过 HTML 特殊字符的内容。<br><code>&lt;%- code %&gt;</code>：显示原始 HTML 内容。<br>注意：<br><code>&lt;%= code %&gt;</code> 和 <code>&lt;%- code %&gt;</code> 的区别，当变量 code 为普通字符串时，两者没有区别。当 code 比如为 <code>&lt;h1&gt;hello&lt;/h1&gt;</code>这种字符串时， <code>&lt;%= code %&gt;</code>会原样输出 <code>&lt;h1&gt;hello&lt;/h1&gt;</code> ，而 <code>&lt;%- code %&gt;</code>则会显示 H1里面的 hello 字符串。</p>
</li>
</ul>
<h4 id="8-页面布局"><a href="#8-页面布局" class="headerlink" title="8. 页面布局"></a>8. 页面布局</h4><p>这里我们不使用layout进行页面布局，而是使用更为简单灵活的include。include 的简单使用如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;%- include a %&gt;</div><div class="line">hello,world!</div><div class="line">&lt;%- include b %&gt;</div></pre></td></tr></table></figure></p>
<p><code>exports</code>和<code>module.exports</code>的区别，<code>exports</code>仅仅是 <code>module.exports</code>的一个地址引用，如果<code>module.exports</code>已经具备一些属性和方法，那么<code>exports</code>收集来的信息将被忽略;</p>
<ul>
<li>最好别分别定义<code>module.exports</code>和<code>exports</code></li>
<li>NodeJs开发者建议导出对象用<code>module.exports</code>,导出多个方法和变量用<code>exports</code><h4 id="9-如何字符串加密"><a href="#9-如何字符串加密" class="headerlink" title="9. 如何字符串加密?"></a>9. 如何字符串加密?</h4></li>
</ul>
<p>当我们提交表单后，比如密码这些敏感信息，不做个加密处理那也太不把用户私密信息当回事了，Node.js提供了一个加密模块 crypto<br>使用方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var express = require(&apos;express&apos;);</div><div class="line">var router = express.Router();</div><div class="line">var crypto = require(&apos;crypto&apos;);</div><div class="line">router.post(&apos;/&apos;,function(req, res)&#123;</div><div class="line">  var userPwd = req.body.txtUserPwd;</div><div class="line">  //生成口令的散列值</div><div class="line">  var md5 = crypto.createHash(&apos;md5&apos;);   //crypto模块功能是加密并生成各种散列</div><div class="line">  var en_upwd = md5.update(userPwd).digest(&apos;hex&apos;);</div><div class="line">  console.log(&apos;加密后的密码:&apos;+en_upwd);</div><div class="line">&#125;);</div><div class="line">module.exports = router;</div></pre></td></tr></table></figure></p>
<h4 id="10-session的使用"><a href="#10-session的使用" class="headerlink" title="10. session的使用"></a>10. session的使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// session的使用</span></div><div class="line">app.use(cookieParser(<span class="string">'keyboard cat'</span>));</div><div class="line"><span class="comment">//使用靠就这个中间件</span></div><div class="line">app.use(session(&#123;</div><div class="line">    secret: <span class="string">"keyboard cat"</span>,</div><div class="line">    resave: <span class="literal">true</span>,</div><div class="line">    saveUninitialized: <span class="literal">true</span></div><div class="line">&#125;));</div></pre></td></tr></table></figure>
<p>注意：坑点：！！！！需要注意的是，必须将上面几句放在<code>app.use(app.router)</code>;之前<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用</span></div><div class="line">req.session.name = username;</div><div class="line">req.session.pwd = pwd;</div></pre></td></tr></table></figure></p>
<p>写完后，用下面两句存储一下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sender.send(req.session);</div><div class="line">sender.end();</div></pre></td></tr></table></figure></p>
<h4 id="11-Express-模板传值对象app-locals、res-locals"><a href="#11-Express-模板传值对象app-locals、res-locals" class="headerlink" title="11. Express 模板传值对象app.locals、res.locals"></a>11. Express 模板传值对象app.locals、res.locals</h4><ul>
<li><code>locals</code>是Express应用中 Application(app)对象和Response(res)对象中的属性，该属性是一个对象。该对象的主要作用是，将值传递到所渲染的模板中。</li>
<li><code>locals对象</code><br>locals对象用于将数据传递至所渲染的模板中。<br>对于如下一个ejs模板：<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;%= url %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">name</span> %&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">introduce</span> %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;  </div><div class="line">  res.render(<span class="string">'index'</span>, &#123;<span class="attr">name</span>:<span class="string">'IT笔录'</span>, <span class="attr">url</span>:<span class="string">'http://itbilu.com'</span>, <span class="attr">introduce</span>:<span class="string">'学习、记录、整理'</span>&#125;);</div><div class="line">  <span class="comment">// 也可以使用 res.locals 变量</span></div><div class="line">  <span class="comment">// res.locals = &#123;</span></div><div class="line">  <span class="comment">//   name:'IT笔录',</span></div><div class="line">  <span class="comment">//   url:'http://itbilu.com',</span></div><div class="line">  <span class="comment">//   introduce:'学习、记录、整理'</span></div><div class="line">  <span class="comment">// &#125;;</span></div><div class="line">  <span class="comment">// res.render('index');</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li><code>app.locals</code>与<code>res.locals</code><br>locals可能存在于app对象中即：<code>app.locals</code>；也可能存在于res对象中，即：<code>res.locals</code>。两者都会将该对象传递至所渲染的页面中。不同的是，<code>app.locals</code>会在整个生命周期中起作用；而<code>res.locals</code>只会有当前请求中起作用。由于<code>app.locals</code>在当前应用所有的渲染模中访问，这样我们就可以在该对象中定义一些顶级/全局的数据，并在渲染模板中使用。<br><strong>注意</strong> ：使用的时候，位置应该是放在路由器的前面，这样才会生效。比如<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">app.use(local);    <span class="comment">// local是我封装了res.locals的函数，位置要在路由器的前面，不然是不行的</span></div><div class="line">app.use(<span class="string">'/'</span>,router);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="12-node文件读取模块fs"><a href="#12-node文件读取模块fs" class="headerlink" title="12. node文件读取模块fs"></a>12. node文件读取模块fs</h4><p>Node.js读取文件内容包括同步和异步两种方式</p>
<ul>
<li><p>同步读取，调用的是readFileSync</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">"fs"</span>);  </div><div class="line"><span class="keyword">var</span> data=fs.readFileSync(<span class="string">"test.js"</span>,<span class="string">"utf-8"</span>);  </div><div class="line"><span class="built_in">console</span>.log(data);</div></pre></td></tr></table></figure>
</li>
<li><p>异步读取，调用readFile</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">"fs"</span>);  </div><div class="line">fs.readFile(<span class="string">"test.js"</span>,<span class="string">'utf-8'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;  </div><div class="line">    <span class="keyword">if</span>(err)&#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"error"</span>);  </div><div class="line">    &#125;<span class="keyword">else</span>&#123;  </div><div class="line">        <span class="built_in">console</span>.log(data);  </div><div class="line">    &#125;  </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>fs.readFile 接收了三个参数，第一个是文件名，第二个是编码方式，第三个为回调函数。<br>其他一下fs的api<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">fs.writeFile(<span class="string">'delete.txt'</span>,<span class="string">'1234567890'</span>，<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>(<span class="string">'youxi!'</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 删除文件</span></div><div class="line">fs.unlink(<span class="string">'delete.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"> <span class="built_in">console</span>.log(<span class="string">'success'</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 修改文件名称</span></div><div class="line">fs.rename(<span class="string">'delete.txt'</span>,<span class="string">'anew.txt'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line"> <span class="built_in">console</span>.log(<span class="string">'rename success'</span>);</div><div class="line"> <span class="comment">// 查看文件状态</span></div><div class="line">fs.stat(<span class="string">'anew.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, stat</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(stat);</div><div class="line"> &#125;);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 判断文件是否存在</span></div><div class="line">fs.exists(<span class="string">'a.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> exists </span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log( exists );</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h4 id="13-mongodb的使用"><a href="#13-mongodb的使用" class="headerlink" title="13. mongodb的使用"></a>13. mongodb的使用</h4><h5 id="1-、如何开启mongodb"><a href="#1-、如何开启mongodb" class="headerlink" title="(1)、如何开启mongodb"></a>(1)、如何开启mongodb</h5><ul>
<li><p>首先，进入到安装mongodb的bin目录，如<code>D:\mongodb\bin</code>,然后执行命令<code>mongod --dbpath f:\MongoDB\data</code> 其中 <code>f:\MongoDB\data</code>是文件存放路径，看到如下信息说明成功了</p>
</li>
<li><p>mongodb的默认端口为27017，所以如果开启了mongodb,可以在浏览器输入<code>http://localhost:27017/</code>,如果现实类似的<code>It looks like you are trying to access MongoDB over HTTP on the native driver port.</code>,则说明mongodb启动成功</p>
</li>
<li><p>mongoose的api地位为<a href="http://www.nodeclass.com/api/mongoose.html#quick_start" target="_blank" rel="external">http://www.nodeclass.com/api/mongoose.html#quick_start</a></p>
</li>
</ul>
<h5 id="如何查看有多少数据库"><a href="#如何查看有多少数据库" class="headerlink" title="如何查看有多少数据库"></a>如何查看有多少数据库</h5><ul>
<li>进入mongodb的bin目录，例如<code>D:\mongodb\bin</code></li>
<li>执行<code>mongo</code>,然后再执行<code>show dbs</code>可以查看到有多少数据库。</li>
<li><p>如果要使用指定的数据库的话，可以执行use 数据库名。eg:use myData<br><strong>这里需要注意的是，mongodb是需要开启的状态。即：<code>mongod --dbpath f:\MongoDB\data</code>这条命令的窗口是要开着的。</strong></p>
<h5 id="2-mongoose的使用"><a href="#2-mongoose的使用" class="headerlink" title="(2)mongoose的使用"></a>(2)mongoose的使用</h5><p>一般我们不直接用MongoDB的函数来操作MongoDB数据库,而使用mongose,mongoose就是一套操作MongoDB数据库的接口.</p>
</li>
<li><p>连接上你的数据库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"><span class="keyword">var</span> db       = mongoose.connect(<span class="string">'mongodb://127.0.0.1:27017/dataBase'</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>Schema<br>一种以文件形式存储的数据库模型骨架，无法直接通往数据库端，不具备对数据库的操作能力，仅仅只是数据库模型在程序片段中的一种表现，可以说是数据属性模型(传统意义的表结构)，又或着是’集合’的模型骨架。说白了就是定义数据的类型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> UserSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    username : &#123; <span class="attr">type</span> : <span class="built_in">String</span> &#125;,</div><div class="line">    password : &#123; <span class="attr">type</span> : <span class="built_in">String</span> &#125;,</div><div class="line">    avatar : &#123; <span class="attr">type</span> : <span class="built_in">String</span> &#125;,</div><div class="line">    age : &#123; <span class="attr">type</span> : <span class="built_in">Number</span> , <span class="attr">default</span> : <span class="number">0</span> &#125;,</div><div class="line">    description : &#123; <span class="attr">type</span> : <span class="built_in">String</span> &#125;,</div><div class="line">    email : &#123; <span class="attr">type</span> : <span class="built_in">String</span> &#125;,</div><div class="line">    github : &#123; <span class="attr">type</span> : <span class="built_in">String</span> &#125;,</div><div class="line">    time : &#123; <span class="attr">type</span> : <span class="built_in">Date</span> , <span class="attr">defaul</span> : <span class="built_in">Date</span>.now &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>model<br>由Schema构造生成的模型，除了Schema定义的数据库骨架以外，还具有数据库操作的行为，类似于管理数据库属性、行为的类.<br>简单的说，就是 Schema定义了数据的类型，那么数据的操作要怎么办呢？ 定义一个类似的类，来操作 Schema声明的数据里面的类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> UserModel = db.model(<span class="string">"user"</span>, UserSchema );</div></pre></td></tr></table></figure>
</li>
</ul>
<p><code>user</code> 数据库中的集合名称, 不存在会创建.</p>
<ul>
<li>Entity<br>由Model创建的实体，使用save方法保存数据，Model和Entity都有能影响数据库的操作，但Model比Entity更具操作性<h6 id="1-、具体的使用"><a href="#1-、具体的使用" class="headerlink" title="(1)、具体的使用"></a>(1)、具体的使用</h6>参考<a href="http://blog.csdn.net/u014267351/article/details/51212107" target="_blank" rel="external">Mongoose使用操作</a></li>
</ul>
<h6 id="2-、Schema-表结构"><a href="#2-、Schema-表结构" class="headerlink" title="(2)、Schema - 表结构"></a>(2)、Schema - 表结构</h6><ul>
<li><p>构造函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">   name:&#123;<span class="attr">type</span>:<span class="built_in">String</span>&#125;, </div><div class="line">   age:&#123;<span class="attr">type</span>:<span class="built_in">Number</span>, </div><div class="line">   <span class="keyword">default</span>:<span class="number">10</span>&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>添加属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Schema.add(&#123; </div><div class="line">  name: <span class="string">'String'</span>,</div><div class="line">  email: <span class="string">'String'</span>, </div><div class="line">  age: <span class="string">'Number'</span> </div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>有时候Schema不仅要为后面的Model和Entity提供公共的属性，还要提供公共的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Schema.method(<span class="string">'say'</span>, </div><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'hello'</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">//这样Model和Entity的实例就能使用这个方法了</span></div></pre></td></tr></table></figure>
</li>
<li><p>添加静态方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Schema.static( <span class="string">'say'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'hello'</span>);&#125; )</div><div class="line"><span class="comment">//静态方法，只限于在Model层就能使用</span></div></pre></td></tr></table></figure>
</li>
<li><p>追加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Schema.methods.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'hello'</span>);</div><div class="line">&#125;; <span class="comment">//静态方法，只限于在Model层就能使用</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="3-、model-文档操作"><a href="#3-、model-文档操作" class="headerlink" title="(3)、model - 文档操作"></a>(3)、model - 文档操作</h6><ul>
<li>构造函数, 参数1:集合名称, 参数2:Schema实例<br><code>db.model(&#39;test1&#39;, TestSchema )</code>;</li>
<li>查询, 参数1忽略,或为空对象则返回所有集合文档</li>
<li><code>model.find({}, callback)</code>;<br>*<code>model.find({},field,callback)</code>; 过滤查询, 参数2:<code>{&#39;name&#39;:1, &#39;age&#39;:0}</code> 查询文档的返回结果包含name, 不包含age(_id默认是1) 1为包含，0为不包含</li>
<li><code>model.find({},null,{limit:20})</code>; 过滤查询,参数3: 游标操作 limit限制返回结果数量为20个,如不足20个则返回所有.</li>
<li><code>model.findOne({}, callback)</code>; 查询找到的第一个文档</li>
<li><code>model.findById(&#39;obj._id&#39;, callback)</code>; 查询找到的第一个文档,同上. 但是只接受 __id 的值查询</li>
<li>创建, 在集合中创建一个文档<br><code>Model.create(文档数据, callback))</code></li>
<li>更新,参数 1:查询条件, 参数2:更新对象,可以使用MondoDB的更新修改器<br><code>Model.update(conditions, update, function(error)</code></li>
<li><p>删除, 参数1:查询条件<br><code>Model.remove(conditions,callback)</code>;</p>
<h6 id="4-、Entity-文档操作"><a href="#4-、Entity-文档操作" class="headerlink" title="(4)、Entity -文档操作"></a>(4)、Entity -文档操作</h6></li>
<li><p>构造函数, 其实就是model的实例<br><code>new TestModel( { name:&#39;xueyou&#39;, age:21 } )</code>;</p>
</li>
<li><p>创建, 在集合中创建一个文档.<br><code>Entity.save(callback)</code>;</p>
<h6 id="5-、修改器和更新器"><a href="#5-、修改器和更新器" class="headerlink" title="(5)、修改器和更新器"></a>(5)、修改器和更新器</h6></li>
<li><p>更新修改器:<br>‘$inc’ 增减修改器,只对数字有效.下面的实例: 找到 age=22的文档,修改文档的age值自增1<br><code>Model.update({&#39;age&#39;:22}, {&#39;$inc&#39;:{&#39;age&#39;:1} });</code> 执行后: age=23</p>
</li>
<li>‘$set’ 指定一个键的值,这个键不存在就创建它.可以是任何MondoDB支持的类型.<br><code>Model.update({&#39;age&#39;:22}, {&#39;$set&#39;:{&#39;age&#39;:&#39;haha&#39;} })</code>; 执行后: age=’haha’</li>
<li><p>‘$unset’ 同上取反,删除一个键<br><code>Model.update({&#39;age&#39;:22}, {&#39;$unset&#39;:{&#39;age&#39;:&#39;haha&#39;} });</code>执行后: age键不存在</p>
<h6 id="6-、数组修改器"><a href="#6-、数组修改器" class="headerlink" title="(6)、数组修改器:"></a>(6)、数组修改器:</h6></li>
<li><p>‘$push’ 给一个键push一个数组成员,键不存在会创建<br><code>Model.update({&#39;age&#39;:22}, {&#39;$push&#39;:{&#39;array&#39;:10} });</code> 执行后: 增加一个 array 键,类型为数组, 有一个成员 10</p>
</li>
<li>‘$addToSet’ 向数组中添加一个元素,如果存在就不添加<br><code>Model.update({&#39;age&#39;:22}, {&#39;$addToSet&#39;:{&#39;array&#39;:10} });</code> 执行后: array中有10所以不会添加</li>
<li>‘$each’ 遍历数组, 和 $push 修改器配合可以插入多个值<br><code>Model.update({&#39;age&#39;:22}, {&#39;$push&#39;:{&#39;array&#39;:{&#39;$each&#39;: [1,2,3,4,5]}} });</code>执行后: array : [10,1,2,3,4,5]</li>
<li>‘$pop’ 向数组中尾部删除一个元素<br><code>Model.update({&#39;age&#39;:22}, {&#39;$pop&#39;:{&#39;array&#39;:1} });</code> 执行后: array : [10,1,2,3,4] tips: 将1改成-1可以删除数组首部元素</li>
<li>‘$pull’ 向数组中删除指定元素<br><code>Model.update({&#39;age&#39;:22}, {&#39;$pull&#39;:{&#39;array&#39;:10} });</code> 执行后: array : [1,2,3,4] 匹配到array中的10后将其删除<h6 id="7-、条件查询"><a href="#7-、条件查询" class="headerlink" title="(7)、条件查询:"></a>(7)、条件查询:</h6><code>&#39;$lt&#39;</code>小于<br><code>&#39;$lte&#39;</code>小于等于<br><code>&#39;$gt&#39;</code>大于<br><code>&#39;$gte&#39;</code>大于等于<br><code>&#39;$ne&#39;</code>不等于<br><code>Model.find({&#39;age&#39;:{ &#39;$gte&#39;:18 , &#39;$lte&#39;:30 } });</code>查询 age 大于等于18并小于等于30的文档</li>
</ul>
<h6 id="8-、或查询-OR"><a href="#8-、或查询-OR" class="headerlink" title="(8)、或查询 OR:"></a>(8)、或查询 OR:</h6><p><code>&#39;$in&#39;</code>一个键对应多个值<br><code>&#39;$nin&#39;</code>同上取反, 一个键不对应指定值<br><code>&#39;$or&#39;</code>多个条件匹配, 可以嵌套 $in 使用<br><code>&#39;$not&#39;</code>同上取反, 查询与特定模式不匹配的文档<br><code>Model.find({&#39;age&#39;:{ &#39;$in&#39;:[20,21,22.&#39;haha&#39;]} } );</code> 查询 age等于20或21或21或’haha’的文档<br><code>Model.find({&quot;$or&quot; : [ {&#39;age&#39;:18} , {&#39;name&#39;:&#39;xueyou&#39;} ] });</code> 查询 age等于18 或 name等于’xueyou’ 的文档</p>
<h6 id="9-、类型查询"><a href="#9-、类型查询" class="headerlink" title="(9)、类型查询:"></a>(9)、类型查询:</h6><p>null 能匹配自身和不存在的值, 想要匹配键的值 为null, 就要通过 ‘$exists’ 条件判定键值已经存在 “$exists” (表示是否存在的意思)<br><code>Model.find(&#39;age&#39; : { &#39;$in&#39; : [null] , &#39;exists&#39; : true } ); 查询 age值为null的文档
Model.find({name:{$exists:true}},function(error,docs){//查询所有存在name属性的文档});
Model.find({telephone:{$exists:false}},function(error,docs){//查询所有不存在telephone属性的文档});</code></p>
<p>######(10)、正则表达式:<br>MongoDb 使用 Prel兼容的正则表达式库来匹配正则表达式<br><code>find( {&#39;name&#39; : /joe/i } )</code>查询name为 joe 的文档, 并忽略大小写<br><code>find( {&#39;name&#39; : /joe?/i } )</code> 查询匹配各种大小写组合</p>
<h6 id="11-、查询数组"><a href="#11-、查询数组" class="headerlink" title="(11)、查询数组:"></a>(11)、查询数组:</h6><p><code>Model.find({&#39;array&#39;:10} );</code> 查询 array(数组类型)键中有10的文档, array : [1,2,3,4,5,10] 会匹配到<br><code>Model.find({&#39;array[5]&#39;:10} );</code>查询 array(数组类型)键中下标5对应的值是10, array : [1,2,3,4,5,10] 会匹配到<br>‘$all’ 匹配数组中多个元素<br><code>Model.find({&#39;array&#39;:[5,10]} );</code> 查询 匹配array数组中 既有5又有10的文档<br>‘$size’ 匹配数组长度<br><code>Model.find({&#39;array&#39;:{&quot;$size&quot; : 3} } );</code>查询 匹配array数组长度为3 的文档<br>‘$slice’ 查询子集合返回<br><code>Model.find({&#39;array&#39;:{&quot;$skice&quot; : 10} } );</code> 查询 匹配array数组的前10个元素<br><code>Model.find({&#39;array&#39;:{&quot;$skice&quot; : [5,10] } } );</code> 查询 匹配array数组的第5个到第10个元素</p>
<h6 id="12-、where"><a href="#12-、where" class="headerlink" title="(12)、where"></a>(12)、where</h6><p>用它可以执行任意javacript语句作为查询的一部分,如果回调函数返回 true 文档就作为结果的一部分返回<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">find(&#123;</div><div class="line">  <span class="string">"$where"</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> x <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</div><div class="line">       <span class="comment">//这个函数中的 this 就是文档</span></div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.x !==<span class="literal">null</span>&amp;&amp;<span class="keyword">this</span>.y !==<span class="literal">null</span>) &#123; </div><div class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.x +<span class="keyword">this</span>.y ===<span class="number">10</span>?<span class="literal">true</span>:<span class="literal">false</span>;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><strong>简化版本</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">find( &#123;&quot;$where&quot; : &quot;this.x + this.y === 10&quot; &#125; )</div><div class="line">find( &#123;&quot;$where&quot; : &quot; function()&#123; return this.x + this.y ===10; &#125; &quot; &#125; )</div></pre></td></tr></table></figure></p>
<h6 id="13-、ObjectId"><a href="#13-、ObjectId" class="headerlink" title="(13)、ObjectId"></a>(13)、ObjectId</h6><p>存储在MongoDB集合中的每个文档（document）都有一个默认的主键_id，这个主键名称是固定的，它可以是mongodb支持的任何数据类型，默认是ObjectId。</p>
<h6 id="14-、mongoose中的schema-index"><a href="#14-、mongoose中的schema-index" class="headerlink" title="(14)、mongoose中的schema.index"></a>(14)、mongoose中的schema.index</h6><p>建索引是为了提高查询速度，要根据实际业务建立索引，太多了也不好，这样更新数据会变慢，因为要更新索引<br><code>TopicSchema.index({create_at: -1});</code><br>1是正序， -1是逆序，复合索引是为了提高查询速度。</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-09-27T15:24:55.896Z" itemprop="dateUpdated">2017-09-27 23:24:55</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2017/09/27/2017/9/27/" target="_blank" rel="external">http://yoursite.com/2017/09/27/2017/9/27/</a>
        
    </div>
    <footer>
        <a href="http://yoursite.com">
            <img src="/./img/avatar.jpg" alt="Lei Y1">
            Lei Y1
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2017/09/27/2017/9/27/&title=《Nodejs 学习小结》 — Designdacity's BLOG&pic=http://yoursite.com./img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2017/09/27/2017/9/27/&title=《Nodejs 学习小结》 — Designdacity's BLOG&source=技术分享" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2017/09/27/2017/9/27/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Nodejs 学习小结》 — Designdacity's BLOG&url=http://yoursite.com/2017/09/27/2017/9/27/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2017/09/27/2017/9/27/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/10/09/2017/10/9/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">前端面试题小集</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/09/10/2017/9/1/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">JavaScript中的call和apply应用</h4>
      </a>
    </div>
  
</nav>



    














</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/./img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="./img/wechat.png" data-alipay="./img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Lei Y1 &copy; 2017</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2017/09/27/2017/9/27/&title=《Nodejs 学习小结》 — Designdacity's BLOG&pic=http://yoursite.com./img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2017/09/27/2017/9/27/&title=《Nodejs 学习小结》 — Designdacity's BLOG&source=技术分享" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2017/09/27/2017/9/27/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Nodejs 学习小结》 — Designdacity's BLOG&url=http://yoursite.com/2017/09/27/2017/9/27/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2017/09/27/2017/9/27/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://yoursite.com/2017/09/27/2017/9/27/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'designdacity';
            clearTimeout(titleTime);
        } else {
            document.title = 'designdacity';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
